{"version":3,"file":"index.mjs","sources":["../../server/src/utils/plugin-id.ts","../../server/src/utils/get-service.ts","../../server/src/register.ts","../../__vite-browser-external","../../server/src/controllers/editorjs.ts","../../server/src/controllers/index.ts","../../server/src/config.ts","../../server/src/routes/index.ts","../../server/src/services/plugin.ts","../../server/src/services/index.ts","../../server/src/index.ts"],"sourcesContent":["const pluginId = \"editorjs\";\n\nexport default pluginId;\n","\"use strict\";\n\nimport pluginId from \"./plugin-id\";\n\nconst getService = (strapi) => strapi.plugin(pluginId).service(\"plugin\");\n\nexport default getService;\n","import { Strapi } from \"@strapi/strapi\";\n\nimport { pluginId } from \"./utils\";\n\nexport const register = ({ strapi }: { strapi: Strapi }) => {\n  strapi.customFields.register({\n    name: pluginId,\n    pluginId: pluginId,\n    type: \"richtext\",\n  });\n};\n","export default {}","import { Context } from \"@strapi/utils/dist/types\";\nimport { Strapi } from \"@strapi/strapi\";\nimport ogs, { SuccessResult } from \"open-graph-scraper\";\nimport { parseMultipartData } from \"@strapi/utils\";\nimport axios from \"axios\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { LocalFileData } from \"get-file-object-from-local-path\";\nimport { getService } from \"../utils\";\nimport { StrapiRequestContext } from \"strapi-typed\";\n\ninterface CustomSuccessResult extends SuccessResult {\n  ogTitle?: string;\n  ogDescription?: string;\n  ogImage?: {\n    url: string;\n  };\n}\n\nexport default ({ strapi }: { strapi: Strapi }) => ({\n  config: async (ctx: StrapiRequestContext<never, any>) => {\n    const config = await getService(\"plugin\").getConfig();\n    ctx.send(config);\n  },\n\n  link: async (ctx: StrapiRequestContext<never, any>) => {\n    const result = await new Promise<{ success: number; meta: any }>(\n      (resolve) => {\n        ogs(ctx.query, (error, results: CustomSuccessResult, response) => {\n          // Проверяем, существует ли свойство 'ogImage' в результатах\n          const imageUrl = results?.ogImage?.url\n            ? { url: results.ogImage.url }\n            : undefined;\n\n          resolve({\n            success: 1,\n            meta: {\n              title: results?.ogTitle,\n              description: results?.ogDescription,\n              image: imageUrl,\n            },\n          });\n        });\n      }\n    );\n\n    ctx.send(result);\n  },\n\n  byFile: async (ctx: Context & StrapiRequestContext<never, any>) => {\n    try {\n      const { files } = parseMultipartData(ctx);\n\n      const [uploadedFile] = await strapi\n        .plugin(\"upload\")\n        .service(\"upload\")\n        .upload({\n          data: {},\n          files: Object.values(files),\n        });\n\n      ctx.send({\n        success: 1,\n        file: uploadedFile,\n      });\n    } catch (e) {\n      ctx.send(\n        {\n          success: 0,\n          message: e.message,\n        },\n        500\n      );\n    }\n  },\n\n  byURL: async (ctx: StrapiRequestContext<never, any>) => {\n    try {\n      const { url } = ctx.request.body;\n      const { name, ext } = path.parse(url);\n      const filePath = `./public/${name}${ext}`;\n\n      const response = await axios.get(url, { responseType: \"arraybuffer\" });\n      const buffer = Buffer.from(response.data, \"binary\");\n\n      await fs.promises.writeFile(filePath, buffer);\n\n      const fileData = new LocalFileData(filePath);\n\n      const file = {\n        path: filePath,\n        name: fileData.name,\n        type: fileData.type,\n        size: Buffer.byteLength(buffer),\n      };\n\n      const [uploadedFile] = await strapi\n        .plugin(\"upload\")\n        .service(\"upload\")\n        .upload({\n          data: {},\n          files: file,\n        });\n\n      await fs.promises.unlink(filePath);\n\n      ctx.send({\n        success: 1,\n        file: uploadedFile,\n      });\n    } catch (e) {\n      ctx.send(\n        {\n          success: 0,\n          message: e.message,\n        },\n        500\n      );\n    }\n  },\n});\n","import upload from \"./editorjs\";\n\nexport default {\n  editorjs: upload,\n};\n","export default {\n  default: {\n    header: null,\n    list: null,\n    checklist: null,\n    embed: null,\n    table: null,\n    warning: null,\n    code: null,\n    link_tool: null,\n    raw: null,\n    quote: null,\n    marker: null,\n    delimiter: null,\n    inlineCode: null,\n    image: null,\n    attaches: null,\n    component: null,\n    minHeight: null,\n  },\n};\n","\"use strict\";\n\nexport default {\n  editorjs: {\n    type: \"admin\",\n    routes: [\n      {\n        method: \"GET\",\n        path: \"/config\",\n        handler: \"editorjs.config\",\n        config: {\n          policies: [\"admin::isAuthenticatedAdmin\"],\n        },\n      },\n    ],\n  },\n  \"content-api\": {\n    type: \"content-api\",\n    routes: [\n      {\n        method: \"GET\",\n        path: \"/link\",\n        handler: \"editorjs.link\",\n        config: {\n          description: \"Get a URL link\",\n          auth: false,\n        },\n      },\n      {\n        method: \"POST\",\n        path: \"/image/byFile\",\n        handler: \"editorjs.byFile\",\n        config: {\n          auth: false,\n        },\n      },\n      {\n        method: \"POST\",\n        path: \"/image/byUrl\",\n        handler: \"editorjs.byURL\",\n        config: {\n          auth: false,\n        },\n      },\n    ],\n  },\n};\n","\"use strict\";\n\nimport { Strapi } from \"@strapi/strapi\";\n\nimport config from \"../config\";\nimport { pluginId } from \"../utils\";\n\nexport default ({ strapi }: { strapi: Strapi }) => ({\n  async getConfig() {\n    const data = await strapi.config.get(`plugin.${pluginId}`, config.default);\n\n    return data;\n  },\n});\n","\"use strict\";\n\nimport plugin from \"./plugin\";\n\nexport default {\n  plugin,\n};\n","\"use strict\";\n\nimport { register } from \"./register\";\nimport controllers from \"./controllers\";\nimport config from \"./config\";\nimport routes from \"./routes\";\nimport services from \"./services\";\n\nexport default {\n  register,\n  config,\n  routes,\n  controllers,\n  services,\n};\n"],"names":["pluginId","getService","strapi","register","fs","upload","ctx","config","result","resolve","ogs","error","results","response","imageUrl","_a","files","parseMultipartData","uploadedFile","e","url","name","ext","path","filePath","axios","buffer","fileData","LocalFileData","file","controllers","routes","plugin","services","index"],"mappings":"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"}